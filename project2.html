<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Eco-friendly Travel Buddy</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f8fa; color: #333; }
header { background: #2ecc71; color: white; padding: 20px; text-align: center; }
.input-section { padding: 20px; text-align: center; }
input { padding: 10px; margin: 10px; width: 250px; border-radius: 4px; border: 1px solid #ccc; }
button { padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; }
button:hover { background: #219150; }
.map-section { height: 60vh; margin: 20px auto; width: 90%; border: 1px solid #ccc; border-radius: 8px; }
.results-section { width: 90%; margin: 20px auto; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
th { background-color: #27ae60; color: white; }
</style>
</head>
<body>

<header>
  <h1>üå± Eco-friendly Travel Buddy</h1>
</header>

<main>
  <section class="input-section">
    <input type="text" id="start" placeholder="Enter Starting Location"/>
    <input type="text" id="destination" placeholder="Enter Destination"/>
    <button id="search-btn">Find Routes</button>
  </section>

  <section id="map" class="map-section"></section>

  <section id="results" class="results-section">
    <h2>üöÄ Travel Options</h2>
    <table>
      <thead>
        <tr>
          <th>Mode</th>
          <th>Distance (km)</th>
          <th>Cost (‚Çπ)</th>
          <th>CO‚ÇÇ (kg)</th>
          <th>Status</th>
          <th>Recommendation</th>
        </tr>
      </thead>
      <tbody id="results-body"></tbody>
    </table>
  </section>
</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script>
let map, routingControl;

// ‚úÖ Telangana Metro Stations
const metroStations = [
  "Miyapur","JNTU College","KPHB Colony","Kukatpally","Dr. B.R. Ambedkar Balanagar",
  "Moosapet","Bharat Nagar","Erragadda","ESI Hospital","S.R. Nagar","Ameerpet",
  "Punjagutta","Irrum Manzil","Khairatabad","Lakdikapul","Assembly","Nampally",
  "MG Bus Station","Malakpet","New Market","Chaderghat","Dilsukhnagar",
  "Musarambagh","Victoria Memorial","LB Nagar","Parade Ground","Paradise",
  "Rasoolpura","Prakash Nagar","Begumpet","Mathura Nagar","Yusufguda",
  "Road No 5 Jubilee Hills","Jubilee Hills Check Post","Peddamma Gudi","Madhapur",
  "Durgam Cheruvu","Hitec City","Raidurg","Parade Ground","Secunderabad East",
  "Secunderabad West","Gandhi Hospital","Musheerabad","RTC X Roads","Chikkadpally",
  "Narayanaguda","Sultan Bazar","Osmania Medical College","MGBS (interchange)",
  "Malakpet","New Market","Chaitanyapuri","Nagole","Stadium","NGRI","Habsiguda",
  "Tarnaka","Mettuguda"
];

// ‚úÖ Telangana Train Stations
const trainStations = [
  "Secunderabad","Hyderabad","Adilabad","Bhongir","Hafizpet","Hitec City",
  "Huppuguda","Jangaon","Kamareddy","Karimnagar","Kazipet","Khammam","Madhira",
  "Mahbubnagar","Mahabubabad","Malakpet","Malkajgiri","Nizamabad","Ramagundam",
  "Tandur","Yadadri","Zahirabad","Basar","Begumpet","Gadwal","Jadcherla",
  "Mancherial","Medak","Medchal","Miryalaguda","Nalgonda","Peddapalli","Shadnagar",
  "Umdanagar","Vikarabad","Warangal","Yakutpura","Sri Bala Brahmeswara","Jogulamba"
];

// Initialize Map
function initMap() {
  map = L.map("map").setView([17.3850, 78.4867], 10);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);
}

// Geocode location to get lat/lon
async function geocodeLocation(location) {
  const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
  const results = await response.json();
  if(results.length>0) return [parseFloat(results[0].lat), parseFloat(results[0].lon)];
  throw new Error("Location not found");
}

// Haversine distance in km
function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2-lat1)*Math.PI/180;
  const dLon = (lon2-lon1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// helper to check availability
function stationCheck(name, list, type) {
  const found = list.some(st => st.toLowerCase() === name.toLowerCase());
  return found ? null : `${type} station not available at ${name}`;
}

// Display travel options in table
async function displayTravelOptions(distanceKm, startCoords, destCoords, startName, destName){
  const resultsBody = document.getElementById("results-body");
  resultsBody.innerHTML="";
  const distance = parseFloat(distanceKm);

  const travelOptions = [
    { mode: "Walking üö∂‚Äç‚ôÇÔ∏è", co2PerKm:0, costPerKm:0 },
    { mode: "Cycling üö¥‚Äç‚ôÄÔ∏è", co2PerKm:0, costPerKm:0 },
    { mode: "Bike/Scooty üèçÔ∏è", co2PerKm:3, costPerKm:103.5/45 },
    { mode: "Car üöó", co2PerKm:5.5, costPerKm:103.5/20 },
    { mode: "Bus üöå", co2PerKm:1.2, costPer10Km:20 },
    { mode: "Metro üöá", co2PerKm:0.8, costPer10Km:20 },
    { mode: "Train üöÜ", co2PerKm:0.6, costPer10Km:30 }
  ];

  travelOptions.forEach(option=>{
    let status="‚úÖ Suitable";
    let recommendation="";

    if(option.mode.includes("Walking") && distance>1.5){
      status="‚ùå Not Suitable";
      recommendation="Better: Private/Public transport";
    } else if(option.mode.includes("Cycling") && distance>7){
      status="‚ùå Not Suitable";
      recommendation="Better: Private/Public transport";
    } 
    else if(option.mode.includes("Metro")){
      const startCheck = stationCheck(startName, metroStations, "Source Metro");
      const destCheck = stationCheck(destName, metroStations, "Destination Metro");
      if(startCheck || destCheck){
        status="‚ùå Not Available";
        recommendation = startCheck || destCheck;
      } else {
        recommendation="Recommended / Affordable public transport üöá";
      }
    } 
    else if(option.mode.includes("Train")){
      const startCheck = stationCheck(startName, trainStations, "Source Railway");
      const destCheck = stationCheck(destName, trainStations, "Destination Railway");
      if(startCheck || destCheck){
        status="‚ùå Not Available";
        recommendation = startCheck || destCheck;
      } else {
        recommendation="Recommended / Affordable public transport üöÜ";
      }
    } 
    else if(option.mode.includes("Bus")){
      recommendation="Affordable public transport üöå";
    } 
    else if(option.mode.includes("Bike") || option.mode.includes("Car")){
      recommendation="Private transport option";
    }

    // Cost and CO‚ÇÇ calculation
    let cost = 0;
    if(option.mode.includes("Bus") || option.mode.includes("Metro") || option.mode.includes("Train")){
      cost = status.includes("Not Available") ? "N/A" : Math.ceil(distance/10)*(option.costPer10Km || 20);
    } else {
      cost = Math.ceil(distance*(option.costPerKm || 0));
    }

    const co2 = status.includes("Not Available") ? "N/A" : (option.co2PerKm*distance).toFixed(2);

    const row = document.createElement("tr");
    row.innerHTML=`
      <td>${option.mode}</td>
      <td>${distance.toFixed(2)}</td>
      <td>${cost}</td>
      <td>${co2}</td>
      <td>${status}</td>
      <td>${recommendation}</td>
    `;
    resultsBody.appendChild(row);
  });
}

document.getElementById("search-btn").addEventListener("click", async ()=>{
  const startName = document.getElementById("start").value.trim();
  const destName = document.getElementById("destination").value.trim();
  if(!startName || !destName){ alert("Enter both locations."); return;}

  if(routingControl) map.removeControl(routingControl);

  try{
    const startCoords = await geocodeLocation(startName);
    const destCoords = await geocodeLocation(destName);

    routingControl = L.Routing.control({
      waypoints: [L.latLng(startCoords[0], startCoords[1]), L.latLng(destCoords[0], destCoords[1])],
      routeWhileDragging: false,
      lineOptions: { styles:[{color:"#27ae60",weight:4}] },
      show:false,
      addWaypoints:false
    }).on("routesfound",(e)=>{
      let distanceKm = (e.routes[0]?.summary?.totalDistance/1000).toFixed(2);
      if(!distanceKm || distanceKm<=0){
        distanceKm = calculateDistance(startCoords[0], startCoords[1], destCoords[0], destCoords[1]).toFixed(2);
      }
      displayTravelOptions(distanceKm, startCoords, destCoords, startName, destName);
    }).addTo(map);

    map.fitBounds([[startCoords[0], startCoords[1]],[destCoords[0], destCoords[1]]]);
  }catch(err){
    alert("Could not display route. Check spelling.");
  }
});

window.onload=initMap;
</script>
</body>
</html>
